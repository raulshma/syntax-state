# Entity Relationships in EF Core

Think about your family and friends. You have **one** mom, your mom can have **many** children, and students can be in **many** classes while classes have **many** students. These are **relationships** - and EF Core helps you model them in your database!

---

## Section 1: Introduction to Relationships

### What Are Relationships?

Relationships define how different pieces of data connect to each other. In EF Core, there are three main types:

| Type             | Example            | Visual      |
| :--------------- | :----------------- | :---------- |
| **One-to-One**   | Person ‚Üî Passport  | üßë ‚Üî      |
| **One-to-Many**  | Blog ‚Üí Posts       |  ‚Üí  |
| **Many-to-Many** | Students ‚Üî Courses | ‚Äç‚Äç ‚Üî  |

<RelationshipDiagram mode="beginner" />

## One-to-One: Like You and Your Shadow

A **one-to-one** relationship means each thing has exactly ONE matching thing.

> **Real-world examples:**
>
> - You ‚Üî Your social security number
> - Country ‚Üî Capital city
> - User ‚Üî Profile details

<DotnetCodePreview
  title="One-to-One Example"
  code={`// Each person has ONE passport
public class Person
{
    public int Id { get; set; }
    public string Name { get; set; }
    
    public Passport Passport { get; set; }  // Link to passport
}

public class Passport
{
public int Id { get; set; }
public string Number { get; set; }

    public int PersonId { get; set; }       // Who owns this?
    public Person Person { get; set; }       // Link back

}`}
steps={[
{
lineNumbers: [7],
highlight: "Navigation to Passport",
explanation: "This lets you access person.Passport directly"
},
{
lineNumbers: [15],
highlight: "Foreign Key",
explanation: "PersonId connects this passport to its owner"
}
]}
/>

## One-to-Many: Like a Folder with Files

A **one-to-many** relationship means one thing can have MANY related things.

> **Real-world examples:**
>
> - One teacher ‚Üí Many students
> - One blog ‚Üí Many posts
> - One order ‚Üí Many items

<DotnetCodePreview
  title="One-to-Many Example"
  code={`// One blog has MANY posts
public class Blog
{
    public int Id { get; set; }
    public string Title { get; set; }
    
    public ICollection<Post> Posts { get; set; }  // Many posts!
}

public class Post
{
public int Id { get; set; }
public string Title { get; set; }

    public int BlogId { get; set; }     // Which blog?
    public Blog Blog { get; set; }       // Link back

}`}
steps={[
{
lineNumbers: [7],
highlight: "Collection Navigation",
explanation: "ICollection<Post> means this blog can have many posts"
},
{
lineNumbers: [15, 16],
highlight: "Foreign Key + Navigation",
explanation: "Each post tracks which blog it belongs to"
}
]}
/>

## Many-to-Many: Like Friends on Social Media

A **many-to-many** relationship means many things connect to many other things.

> **Real-world examples:**
>
> - Students ‚Üî Classes (you take many, classes have many students)
> - Actors ‚Üî Movies (actors are in many movies, movies have many actors)
> - Products ‚Üî Categories

<DotnetCodePreview
  title="Many-to-Many Example"
  code={`// Students can enroll in many courses
// Courses can have many students
public class Student
{
    public int Id { get; set; }
    public string Name { get; set; }
    
    public ICollection<Course> Courses { get; set; }
}

public class Course
{
public int Id { get; set; }
public string Title { get; set; }

    public ICollection<Student> Students { get; set; }

}`}
steps={[
{
lineNumbers: [8],
highlight: "Student's courses",
explanation: "A student can be in many courses"
},
{
lineNumbers: [16],
highlight: "Course's students",
explanation: "A course can have many students"
}
]}
/>

<ProgressCheckpoint section="intro-relationships" xpReward={8} />

---

## Section 2: One-to-Many Relationships

### The Most Common Relationship

One-to-many is the most frequently used relationship. Let's see it in action:

<DotnetCodePreview
  title="Complete One-to-Many Example"
  code={`// One blog has MANY posts
public class Blog
{
    public int Id { get; set; }
    public string Title { get; set; } = "";
    
    // Navigation property - the "many" side
    public ICollection<Post> Posts { get; set; } = new List<Post>();
}

public class Post
{
    public int Id { get; set; }
    public string Title { get; set; } = "";
    public string Content { get; set; } = "";
    
    // Foreign key - connects to Blog
    public int BlogId { get; set; }
    
    // Navigation property - the "one" side
    public Blog Blog { get; set; } = null!;
}`}
  steps={[
    {
      lineNumbers: [8],
      highlight: "Collection navigation",
      explanation: "ICollection<Post> means this blog can have many posts"
    },
    {
      lineNumbers: [18],
      highlight: "Foreign key",
      explanation: "BlogId stores which blog this post belongs to"
    },
    {
      lineNumbers: [21],
      highlight: "Reference navigation",
      explanation: "Blog property lets you access the parent blog"
    }
  ]}
/>

### Using One-to-Many

```csharp
// Create a blog with posts
var blog = new Blog { Title = "My Tech Blog" };
blog.Posts.Add(new Post { Title = "First Post", Content = "Hello!" });
blog.Posts.Add(new Post { Title = "Second Post", Content = "More content" });

context.Blogs.Add(blog);
await context.SaveChangesAsync();

// Query with related data
var blogWithPosts = await context.Blogs
    .Include(b => b.Posts)
    .FirstOrDefaultAsync(b => b.Id == 1);

Console.WriteLine($"Blog: {blogWithPosts.Title}");
foreach (var post in blogWithPosts.Posts)
{
    Console.WriteLine($"  - {post.Title}");
}
```

<ProgressCheckpoint section="one-to-many" xpReward={9} />

---

## Section 3: Many-to-Many Relationships

### When Both Sides Have Many

Many-to-many relationships are used when items on both sides can connect to multiple items on the other side.

<DotnetCodePreview
  title="Simple Many-to-Many (EF Core 5+)"
  code={`// Students can enroll in many courses
// Courses can have many students
public class Student
{
    public int Id { get; set; }
    public string Name { get; set; } = "";
    
    public ICollection<Course> Courses { get; set; } = new List<Course>();
}

public class Course
{
    public int Id { get; set; }
    public string Title { get; set; } = "";
    
    public ICollection<Student> Students { get; set; } = new List<Student>();
}`}
  steps={[
    {
      lineNumbers: [8],
      highlight: "Student's courses",
      explanation: "A student can be enrolled in many courses"
    },
    {
      lineNumbers: [16],
      highlight: "Course's students",
      explanation: "A course can have many students enrolled"
    }
  ]}
/>

### Using Many-to-Many

```csharp
// Create students and courses
var student = new Student { Name = "Alice" };
var course1 = new Course { Title = "Math 101" };
var course2 = new Course { Title = "Science 101" };

// Enroll student in courses
student.Courses.Add(course1);
student.Courses.Add(course2);

context.Students.Add(student);
await context.SaveChangesAsync();

// Query many-to-many
var studentWithCourses = await context.Students
    .Include(s => s.Courses)
    .FirstOrDefaultAsync(s => s.Name == "Alice");

Console.WriteLine($"Student: {studentWithCourses.Name}");
Console.WriteLine($"Enrolled in: {string.Join(", ", studentWithCourses.Courses.Select(c => c.Title))}");
```

<InfoBox type="tip">
  **EF Core 5+ Magic:** EF Core automatically creates a join table behind the scenes! You don't need to create it yourself.
</InfoBox>

## Quick Summary

| Relationship | One Side      | Other Side    | Example            |
| :----------- | :------------ | :------------ | :----------------- |
| **1:1**      | Single entity | Single entity | Person ‚Üî Passport  |
| **1:N**      | Single entity | Collection    | Blog ‚Üí Posts       |
| **N:N**      | Collection    | Collection    | Students ‚Üî Courses |

<ProgressCheckpoint section="many-to-many" xpReward={8} />
