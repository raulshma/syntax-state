# API Versioning Strategies: Choosing the Right Approach

There are multiple ways to implement API versioning, each with trade-offs. Let's explore the three main strategies and learn how to implement them in ASP.NET Core.

## Section 1: Versioning Introduction & Strategies 

### The Three Main Versioning Strategies

**1. URI Path Versioning (Most Popular) **
```
GET /api/v1/users
GET /api/v2/users
```

**Pros:** Extremely visible, easy to test, industry standard (Twitter, Stripe, GitHub)
**Cons:** Version appears in every URL

**2. Query String Versioning **
```
GET /api/users?api-version=1.0
GET /api/users?api-version=2.0
```

**Pros:** Keeps base URI clean, easy to add to existing APIs
**Cons:** Easy to forget, harder to cache

**3. Header Versioning **
```http
GET /api/users
X-API-Version: 1.0
```

**Pros:** Cleanest URLs, follows REST principles
**Cons:** Not visible in browser, harder to test

<ProgressCheckpoint section="versioning-intro" xpReward={10} />

### Comparison Table 

| Strategy | Visibility | Ease of Use | Best For |
|:---------|:-----------|:------------|:---------|
| **URI Path** | ⭐⭐⭐ | ⭐⭐⭐ | Public APIs |
| **Query String** | ⭐⭐ | ⭐⭐ | Internal APIs |
| **Header** | ⭐ | ⭐ | Enterprise APIs |

<ProgressCheckpoint section="strategies" xpReward={10} />

---

## Section 2: ASP.NET Core Implementation ️

### Step 1: Install Package

```bash
dotnet add package Asp.Versioning.Mvc
```

### Step 2: Configure Services

```csharp
// Program.cs
using Asp.Versioning;

builder.Services.AddApiVersioning(options =>
{
    options.DefaultApiVersion = new ApiVersion(1, 0);
    options.AssumeDefaultVersionWhenUnspecified = true;
    options.ReportApiVersions = true;
    
    options.ApiVersionReader = ApiVersionReader.Combine(
        new UrlSegmentApiVersionReader(),
        new QueryStringApiVersionReader(),
        new HeaderApiVersionReader("X-API-Version")
    );
});
```


### Step 3: URI Path Versioning Implementation

```csharp
[ApiController]
[Route("api/v{version:apiVersion}/[controller]")]
[ApiVersion("1.0")]
public class UsersV1Controller : ControllerBase
{
    [HttpGet("{id}")]
    public IActionResult GetUser(int id)
    {
        return Ok(new { Id = id, Name = "John" });
    }
}

[ApiController]
[Route("api/v{version:apiVersion}/[controller]")]
[ApiVersion("2.0")]
public class UsersV2Controller : ControllerBase
{
    [HttpGet("{id}")]
    public IActionResult GetUser(int id)
    {
        return Ok(new { 
            Id = id, 
            FullName = "John Doe",
            Email = "john@example.com"
        });
    }
}
```

**Usage:**
```http
GET /api/v1/users/123  → Returns v1 format
GET /api/v2/users/123  → Returns v2 format
```

### Multiple Versions in One Controller

```csharp
[ApiController]
[Route("api/v{version:apiVersion}/[controller]")]
[ApiVersion("1.0")]
[ApiVersion("2.0")]
public class ProductsController : ControllerBase
{
    [HttpGet("{id}")]
    [MapToApiVersion("1.0")]
    public IActionResult GetProductV1(int id)
    {
        return Ok(new { Id = id, Name = "Product" });
    }
    
    [HttpGet("{id}")]
    [MapToApiVersion("2.0")]
    public IActionResult GetProductV2(int id)
    {
        return Ok(new { 
            Id = id, 
            Name = "Product",
            Price = 99.99
        });
    }
}
```

<ProgressCheckpoint section="aspnet-implementation" xpReward={10} />

---

## Section 3: Best Practices 

### Start with v1

```csharp
❌ /api/users
✅ /api/v1/users
```

### Use Major Versions Only in URLs

```csharp
✅ /api/v1/users
✅ /api/v2/users
❌ /api/v1.1/users  // Confusing!
```

### Support Multiple Versions

```csharp
[ApiVersion("1.0")]
[ApiVersion("2.0")]  // Current
[ApiVersion("3.0", Deprecated = true)]  // Deprecated
```

### Add Version Info to Responses

```csharp
[HttpGet]
public IActionResult GetData()
{
    Response.Headers.Add("X-API-Version", "2.0");
    Response.Headers.Add("X-Supported-Versions", "1.0, 2.0");
    return Ok(data);
}
```

### Query String Implementation

```csharp
// Configure
options.ApiVersionReader = new QueryStringApiVersionReader("api-version");

// Usage
GET /api/orders?api-version=1.0  → v1 format
GET /api/orders?api-version=2.0  → v2 format
GET /api/orders                  → Default version
```

### Header Implementation

```csharp
// Configure
options.ApiVersionReader = new HeaderApiVersionReader("X-API-Version");

// Usage
GET /api/customers/123
X-API-Version: 2.0
→ Returns v2 format
```

<KeyConcept title="Golden Rule">
  Once an API version is public, **NEVER** change its behavior. If you need different behavior, create a new version.
</KeyConcept>

<ProgressCheckpoint section="strategies" xpReward={10} />
