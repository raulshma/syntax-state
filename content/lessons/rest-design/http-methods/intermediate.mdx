# HTTP Methods & Status Codes: Best Practices for .NET APIs

Using the correct HTTP methods and status codes is crucial for building predictable, maintainable APIs.

## Section 1: HTTP Methods Deep Dive ️

### The Big 5 Methods

| Method | Use Case | Idempotent? | Safe? |
|:-------|:---------|:------------|:------|
| **GET** | Retrieve data |  Yes |  Yes |
| **POST** | Create new resource |  No |  No |
| **PUT** | Replace entire resource |  Yes |  No |
| **PATCH** | Partially update resource | ️ Depends |  No |
| **DELETE** | Remove resource |  Yes |  No |

<InfoBox type="info">
  **Key Terms:**
  - **Safe:** Doesn't modify data (read-only)
  - **Idempotent:** Calling it multiple times has the same effect as calling it once
</InfoBox>

### GET - Retrieve Resources 

```csharp
[HttpGet("{id}")]
[ProducesResponseType(StatusCodes.Status200OK, Type = typeof(UserDto))]
[ProducesResponseType(StatusCodes.Status404NotFound)]
[ResponseCache(Duration = 60)]
public IActionResult GetUser(int id)
{
    var user = _repository.GetById(id);
    
    if (user == null)
        return NotFound();
    
    return Ok(user);
}
```

**Best Practices:**
- Always return 404 if resource doesn't exist
- Use query parameters for filtering, sorting, pagination
- Implement caching for frequently accessed data

<ProgressCheckpoint section="get-method" xpReward={3} />

### POST - Create New Resources 

```csharp
[HttpPost]
[ProducesResponseType(StatusCodes.Status201Created)]
[ProducesResponseType(StatusCodes.Status400BadRequest)]
public IActionResult CreateUser([FromBody] CreateUserDto dto)
{
    if (!ModelState.IsValid)
        return BadRequest(ModelState);
    
    if (_repository.EmailExists(dto.Email))
        return Conflict(new { error = "Email already exists" });
    
    var user = _repository.Create(dto);
    
    return CreatedAtAction(nameof(GetUser), new { id = user.Id }, user);
}
```

**Best Practices:**
- Return 201 Created (not 200 OK)
- Include Location header with URL to the new resource
- Use 409 Conflict for duplicate resources

<ProgressCheckpoint section="post-method" xpReward={3} />


### PUT vs PATCH - The Critical Difference 

<InfoBox type="warning">
  **PUT vs PATCH:**
  - **PUT:** "Replace everything with this" - Missing fields get deleted
  - **PATCH:** "Update only these fields" - Other fields stay unchanged
</InfoBox>

**PUT - Replace Entire Resource:**
```csharp
[HttpPut("{id}")]
public IActionResult UpdateUser(int id, [FromBody] UpdateUserDto dto)
{
    if (!_repository.Exists(id))
        return NotFound();
    
    _repository.Update(id, dto); // Replaces ALL fields
    return NoContent();
}
```

**PATCH - Partial Update:**
```csharp
[HttpPatch("{id}")]
public IActionResult PatchUser(int id, [FromBody] PatchUserDto dto)
{
    var user = _repository.GetById(id);
    if (user == null)
        return NotFound();
    
    // Update only provided fields
    if (dto.Name != null) user.Name = dto.Name;
    if (dto.Email != null) user.Email = dto.Email;
    
    _repository.Save(user);
    return NoContent();
}
```

<ProgressCheckpoint section="put-method" xpReward={3} />

<ProgressCheckpoint section="patch-method" xpReward={3} />

### DELETE - Remove Resource ️

```csharp
[HttpDelete("{id}")]
[Authorize(Roles = "Admin")]
public IActionResult DeleteUser(int id)
{
    if (!_repository.Exists(id))
        return NotFound();
    
    _repository.Delete(id);
    return NoContent();
}
```

**Soft Delete Pattern:**
```csharp
[HttpDelete("{id}")]
public IActionResult DeleteUser(int id)
{
    var user = _repository.GetById(id);
    if (user == null)
        return NotFound();
    
    // Soft delete - mark as deleted instead of removing
    user.IsDeleted = true;
    user.DeletedAt = DateTime.UtcNow;
    _repository.Save(user);
    
    return NoContent();
}
```

<ProgressCheckpoint section="delete-method" xpReward={3} />

---

## Section 2: Status Codes in ASP.NET Core 

### Success Responses (2xx)

```csharp
// 200 OK - Standard success with body
return Ok(data);

// 201 Created - Resource created
return CreatedAtAction(nameof(GetUser), new { id = user.Id }, user);

// 202 Accepted - Request accepted, processing async
return Accepted();

// 204 No Content - Success with no body
return NoContent();
```

### Client Error Responses (4xx)

```csharp
// 400 Bad Request - Validation failed
return BadRequest(ModelState);

// 401 Unauthorized - Not authenticated
return Unauthorized();

// 403 Forbidden - Authenticated but no permission
return Forbid();

// 404 Not Found - Resource doesn't exist
return NotFound();

// 409 Conflict - Resource conflict (e.g., duplicate)
return Conflict(new { error = "Email already exists" });

// 422 Unprocessable Entity - Semantic errors
return UnprocessableEntity(new { error = "Cannot delete user with active orders" });
```

### Server Error Responses (5xx)

```csharp
// 500 Internal Server Error
return StatusCode(500, new { error = "An error occurred" });

// 503 Service Unavailable
return StatusCode(503, new { error = "Service temporarily unavailable" });
```

<ProgressCheckpoint section="status-codes-dotnet" xpReward={5} />

---

## Section 3: Complete CRUD Example 

Here's a complete controller implementing all methods correctly:

```csharp
[ApiController]
[Route("api/[controller]")]
[Authorize]
public class UsersController : ControllerBase
{
    private readonly IUserRepository _repository;

    // GET: api/users
    [HttpGet]
    [ResponseCache(Duration = 30)]
    public IActionResult GetAll([FromQuery] int page = 1)
    {
        var users = _repository.GetAll(page, pageSize: 20);
        return Ok(users);
    }

    // GET: api/users/5
    [HttpGet("{id}")]
    public IActionResult Get(int id)
    {
        var user = _repository.GetById(id);
        if (user == null)
            return NotFound();
        return Ok(user);
    }

    // POST: api/users
    [HttpPost]
    public IActionResult Create([FromBody] CreateUserDto dto)
    {
        if (!ModelState.IsValid)
            return BadRequest(ModelState);
        
        if (_repository.EmailExists(dto.Email))
            return Conflict(new { error = "Email already exists" });
        
        var user = _repository.Create(dto);
        return CreatedAtAction(nameof(Get), new { id = user.Id }, user);
    }

    // PUT: api/users/5
    [HttpPut("{id}")]
    public IActionResult Update(int id, [FromBody] UpdateUserDto dto)
    {
        if (!ModelState.IsValid)
            return BadRequest(ModelState);
        
        if (!_repository.Exists(id))
            return NotFound();
        
        _repository.Update(id, dto);
        return NoContent();
    }

    // DELETE: api/users/5
    [HttpDelete("{id}")]
    [Authorize(Roles = "Admin")]
    public IActionResult Delete(int id)
    {
        if (!_repository.Exists(id))
            return NotFound();
        
        _repository.Delete(id);
        return NoContent();
    }
}
```

<ProgressCheckpoint section="status-codes" xpReward={10} />
