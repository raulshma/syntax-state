# Service Lifetimes: Singleton, Scoped, Transient

Remember our restaurant analogy? Let's use it to understand the three "lifetimes" a service can have! ï¸

---

## Section 1: The Three Lifetimes

Think about different types of workers in a restaurant:

<ServiceLifetimeDemo mode="beginner" />

| Lifetime         | Restaurant Analogy | Behavior                                    |
| :--------------- | :----------------- | :------------------------------------------ |
| **Singleton**  | Head Chef â€       | ONE person, works all day for everyone      |
| **Scoped**     | Personal Waiter ğŸ§‘â€ | ONE per table/group, serves that group only |
| **Transient**  | Napkins ğŸ§»         | Fresh one EVERY time you ask                |

### Singleton: One for Everyone

<InfoBox type="tip">
  **Singleton** = Created ONCE, shared by the ENTIRE application forever.
</InfoBox>

Think of it like:
- â€ The **head chef** - one person cooking for all customers
-  The **menu board** - one board everyone reads

```csharp
// This logger is shared by everyone in the app!
builder.Services.AddSingleton<ILogger, ConsoleLogger>();
```

**Good for:**
-  Configuration settings (they don't change)
-  Logging (write to one place)
-  Expensive resources (database connection pools)

<ProgressCheckpoint section="lifetime-overview" xpReward={8} />

---

## Section 2: Scoped and Transient

### Scoped: One per Table (Request)

<InfoBox type="tip">
  **Scoped** = Created ONCE per "request", shared within that request.
</InfoBox>

Think of it like:
- ğŸ§‘â€ Your **personal waiter** - serves your table throughout your meal
-  Your **order slip** - used for your table's entire visit

```csharp
// New DbContext for each HTTP request!
builder.Services.AddScoped<AppDbContext>();
```

**Good for:**
-  Database contexts (one transaction per request)
-  Shopping carts (tracks one user's session)

### Transient: Fresh Every Time

<InfoBox type="tip">
  **Transient** = Created NEW every single time it's requested.
</InfoBox>

Think of it like:
- ğŸ§» **Napkins** - fresh one every time you ask
- ğŸ¥¢ **Chopsticks** - new pair for each dish

```csharp
// Brand new email service for every injection!
builder.Services.AddTransient<IEmailService, SmtpEmailService>();
```

**Good for:**
-  Lightweight services (quick to create)
-  Stateless operations (no data between calls)

<ProgressCheckpoint section="lifetime-comparison" xpReward={9} />

---

## Section 3: Quick Reference

### Registration Cheat Sheet

```csharp
// In Program.cs

// ğŸ’œ Singleton - ONE instance FOREVER
builder.Services.AddSingleton<ILogger, ConsoleLogger>();

// ğŸ’™ Scoped - ONE instance per REQUEST
builder.Services.AddScoped<IShoppingCart, ShoppingCart>();

// ğŸ’š Transient - NEW instance EVERY TIME
builder.Services.AddTransient<IEmailService, SmtpEmailService>();
```

### Memory Trick ğŸ§ 

| Lifetime      | How Long It Lives           | Remember It As                              |
| :------------ | :-------------------------- | :------------------------------------------ |
| **Singleton** | App start â†’ App stop        | "**S**ingleton = **S**tays forever"         |
| **Scoped**    | Request start â†’ Request end | "**Sc**oped = **Sc**reen refresh = new one" |
| **Transient** | Created â†’ Used â†’ Gone       | "**T**ransient = **T**hrow away after use"  |

### Key Takeaways

<InfoBox type="tip" title="Remember">
-  **Singleton** = Head Chef - one for the whole restaurant (app)
-  **Scoped** = Personal Waiter - one per table (request)
-  **Transient** = Napkins - fresh every time you ask
- ï¸ Use **Scoped for database** contexts (most common!)
</InfoBox>

<ProgressCheckpoint section="lifetime-pitfalls" xpReward={8} />
