# Private Fields: Protecting Your Data

Private fields are like a vault inside your class - only the class itself can access what's inside. This is **encapsulation** - hiding internal details and exposing only what's necessary. With the `#` syntax, JavaScript finally has true privacy!

---

## Section 1: Understanding Privacy

### The Bank Vault Analogy 

Imagine a bank account:
- **Public**: Account holder name, account number (visible to tellers)
- **Private**: PIN, internal balance calculations (only the system knows)

```javascript
class BankAccount {
  // Public - anyone can see
  accountHolder;
  
  // Private - only the class can access
  #balance;
  #pin;
  
  constructor(holder, initialBalance, pin) {
    this.accountHolder = holder;
    this.#balance = initialBalance;
    this.#pin = pin;
  }
}
```

<InfoBox type="info">
**Private fields** start with `#` and can only be accessed inside the class that defines them. They're not accessible from outside, not even by subclasses!
</InfoBox>

### Before Private Fields (The Old Way)

```javascript
// Convention only - not truly private!
class OldWay {
  constructor() {
    this._secretData = 'Anyone can still access this!';
  }
}

const obj = new OldWay();
console.log(obj._secretData); // Works! Not really private üò¨
```

<CodePlayground
  initialCode={`// The problem with underscore convention

class OldBankAccount {
  constructor(balance) {
    this._balance = balance;  // Convention: "please don't touch"
  }
  
  getBalance() {
    return this._balance;
  }
}

const oldAccount = new OldBankAccount(1000);

// The underscore is just a hint - anyone can still access it!
console.log('Using getter:', oldAccount.getBalance());
console.log('Direct access:', oldAccount._balance);  // Works! 

// Anyone can modify it too!
oldAccount._balance = 999999;
console.log('After tampering:', oldAccount.getBalance());

console.log('\\n--- The underscore convention provides NO real protection! ---');`}
  height={300}
/>

<ProgressCheckpoint section="understanding-privacy" xpReward={15} />

---

## Section 2: Private Fields Syntax

### True Privacy with `#`

<CodePlayground
  initialCode={`// True private fields with #

class BankAccount {
  // Private fields MUST be declared at class level
  #balance;
  #transactionHistory = [];
  
  // Public field
  accountHolder;
  
  constructor(holder, initialBalance) {
    this.accountHolder = holder;
    this.#balance = initialBalance;
    this.#logTransaction('OPEN', initialBalance);
  }
  
  // Private method
  #logTransaction(type, amount) {
    this.#transactionHistory.push({
      type,
      amount,
      date: new Date().toISOString()
    });
  }
  
  // Public methods to interact with private data
  deposit(amount) {
    if (amount <= 0) throw new Error('Invalid amount');
    this.#balance += amount;
    this.#logTransaction('DEPOSIT', amount);
    return this.#balance;
  }
  
  withdraw(amount) {
    if (amount > this.#balance) {
      throw new Error('Insufficient funds');
    }
    this.#balance -= amount;
    this.#logTransaction('WITHDRAW', amount);
    return this.#balance;
  }
  
  getBalance() {
    return this.#balance;
  }
  
  getStatement() {
    return this.#transactionHistory.map(t => 
      \`\${t.type}: $\${t.amount}\`
    ).join('\\n');
  }
}

const account = new BankAccount('Alice', 1000);

// Public access works
console.log('Holder:', account.accountHolder);
console.log('Balance:', account.getBalance());

account.deposit(500);
account.withdraw(200);
console.log('\\nStatement:');
console.log(account.getStatement());

// Private access fails!
// console.log(account.#balance);  // SyntaxError!
// account.#balance = 999999;      // SyntaxError!

console.log('\\n Private fields are truly protected!');`}
  height={500}
/>

<KeyConcept title="Private Field Rules">
1. Must be declared at the class level (not in constructor)
2. Name must start with `#`
3. Cannot be accessed outside the class (SyntaxError)
4. Cannot be dynamically created or deleted
5. Each class has its own private namespace
</KeyConcept>

### Private Fields Must Be Declared

```javascript
class Example {
  #declared = 'ok';  // ‚úÖ Declared at class level
  
  constructor() {
    // this.#notDeclared = 'error';  // ‚ùå SyntaxError!
    this.#declared = 'modified';     // ‚úÖ Can modify declared field
  }
}
```

<ProgressCheckpoint section="private-fields-syntax" xpReward={20} />

---

## Section 3: Private Methods

### Hiding Implementation Details

Private methods keep internal logic hidden:

<CodePlayground
  initialCode={`// Private methods

class PasswordManager {
  #passwords = new Map();
  #masterKey;
  
  constructor(masterPassword) {
    this.#masterKey = this.#hash(masterPassword);
  }
  
  // Private method - internal hashing logic
  #hash(value) {
    // Simplified hash for demo (use proper crypto in real apps!)
    let hash = 0;
    for (let i = 0; i < value.length; i++) {
      hash = ((hash << 5) - hash) + value.charCodeAt(i);
      hash = hash & hash;
    }
    return hash.toString(16);
  }
  
  // Private method - encryption simulation
  #encrypt(data) {
    return btoa(data + this.#masterKey);
  }
  
  // Private method - decryption simulation
  #decrypt(encrypted) {
    const decrypted = atob(encrypted);
    return decrypted.replace(this.#masterKey, '');
  }
  
  // Private validation
  #validateSite(site) {
    if (!site || site.length < 3) {
      throw new Error('Invalid site name');
    }
  }
  
  // Public API
  addPassword(site, password) {
    this.#validateSite(site);
    const encrypted = this.#encrypt(password);
    this.#passwords.set(site, encrypted);
    console.log(\` Password saved for \${site}\`);
  }
  
  getPassword(site) {
    const encrypted = this.#passwords.get(site);
    if (!encrypted) return null;
    return this.#decrypt(encrypted);
  }
  
  listSites() {
    return Array.from(this.#passwords.keys());
  }
}

const pm = new PasswordManager('myMasterPass123');

pm.addPassword('github.com', 'gh_secret_456');
pm.addPassword('gmail.com', 'email_pass_789');

console.log('\\nSaved sites:', pm.listSites());
console.log('GitHub password:', pm.getPassword('github.com'));

// Can't access private methods!
// pm.#hash('test');  // SyntaxError!
// pm.#encrypt('data');  // SyntaxError!`}
  height={500}
/>

### Private Getters and Setters

You can also make getters and setters private:

```javascript
class Temperature {
  #celsius;
  
  constructor(celsius) {
    this.#celsius = celsius;
  }
  
  // Private getter
  get #fahrenheit() {
    return this.#celsius * 9/5 + 32;
  }
  
  // Private setter
  set #fahrenheit(f) {
    this.#celsius = (f - 32) * 5/9;
  }
  
  // Public method using private accessor
  display() {
    return `${this.#celsius}¬∞C = ${this.#fahrenheit}¬∞F`;
  }
}
```

<ProgressCheckpoint section="private-methods" xpReward={20} />

---

## Section 4: Private Static Members

### Class-Level Privacy

Static members can also be private:

<CodePlayground
  initialCode={`// Private static fields and methods

class ApiClient {
  // Private static - shared secret, not accessible outside
  static #apiKey = 'sk_live_abc123xyz';
  static #baseUrl = 'https://api.example.com';
  static #requestCount = 0;
  
  // Private static method
  static #buildHeaders() {
    return {
      'Authorization': \`Bearer \${ApiClient.#apiKey}\`,
      'Content-Type': 'application/json'
    };
  }
  
  // Private static method
  static #logRequest(endpoint) {
    ApiClient.#requestCount++;
    console.log(\`[Request #\${ApiClient.#requestCount}] \${endpoint}\`);
  }
  
  // Public static methods
  static async get(endpoint) {
    ApiClient.#logRequest(endpoint);
    const url = \`\${ApiClient.#baseUrl}\${endpoint}\`;
    console.log(\`GET \${url}\`);
    console.log('Headers:', ApiClient.#buildHeaders());
    // In real code: return fetch(url, { headers: this.#buildHeaders() });
  }
  
  static async post(endpoint, data) {
    ApiClient.#logRequest(endpoint);
    console.log(\`POST \${ApiClient.#baseUrl}\${endpoint}\`);
    console.log('Data:', data);
  }
  
  static getRequestCount() {
    return ApiClient.#requestCount;
  }
}

// Use the public API
ApiClient.get('/users');
ApiClient.post('/users', { name: 'Alice' });
ApiClient.get('/products');

console.log('\\nTotal requests:', ApiClient.getRequestCount());

// Can't access private static members!
// console.log(ApiClient.#apiKey);  // SyntaxError!
// ApiClient.#buildHeaders();       // SyntaxError!`}
  height={450}
/>

<InfoBox type="tip">
**Use private static for**: API keys, configuration secrets, internal counters, helper functions that shouldn't be exposed.
</InfoBox>

### Privacy and Inheritance

<CodePlayground
  initialCode={`// Private fields and inheritance

class Parent {
  #secret = 'parent secret';
  
  getSecret() {
    return this.#secret;
  }
  
  #privateMethod() {
    return 'parent private method';
  }
  
  callPrivate() {
    return this.#privateMethod();
  }
}

class Child extends Parent {
  // Child has its OWN #secret - different from parent's!
  #secret = 'child secret';
  
  getChildSecret() {
    return this.#secret;  // Accesses CHILD's #secret
  }
  
  // Cannot access parent's private field!
  // tryAccessParent() {
  //   return super.#secret;  // SyntaxError!
  // }
}

const child = new Child();

// Parent's private field accessed through inherited method
console.log('Via inherited getSecret():', child.getSecret());

// Child's own private field
console.log('Via getChildSecret():', child.getChildSecret());

// Inherited method calling parent's private method
console.log('Via callPrivate():', child.callPrivate());

console.log('\\nÔ∏è Private fields are NOT inherited!');
console.log('Each class has its own private namespace.');`}
  height={420}
/>

<Quiz id="private-quiz">
  <Question>What character marks a field as private?</Question>
  <Answer>_ (underscore)</Answer>
  <Answer>@ (at sign)</Answer>
  <Answer correct># (hash)</Answer>
  <Answer>$ (dollar sign)</Answer>
</Quiz>

<Quiz id="private-access-quiz">
  <Question>Can a child class access its parent's private fields?</Question>
  <Answer correct>No, private fields are not inherited</Answer>
  <Answer>Yes, using super.#field</Answer>
  <Answer>Yes, using this.#field</Answer>
  <Answer>Only if the parent allows it</Answer>
</Quiz>

### Summary

| Concept | Key Point |
|:--------|:----------|
| **Syntax** | `#fieldName` for private members |
| **Declaration** | Must be declared at class level |
| **Access** | Only within the defining class |
| **Inheritance** | NOT inherited by child classes |
| **Static** | Can be `static #field` |
| **Methods** | Can have private methods too |

<ProgressCheckpoint section="private-static" xpReward={20} />
