# Webpack: Configuration Deep Dive

Now that you understand the basics, let's explore real-world Webpack configurations and optimization techniques.

<InfoBox type="tip" title="The Recipe Book Analogy">
Think of webpack.config.js as a detailed recipe book. Each section (entry, output, module, plugins) is a chapter with specific instructions. The more complex your dish (application), the more detailed your recipe needs to be.
</InfoBox>

<ProgressCheckpoint section="introduction" xpReward={15} />

## Complete Configuration Structure

```javascript
// webpack.config.js
const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')
const MiniCssExtractPlugin = require('mini-css-extract-plugin')

const isDev = process.env.NODE_ENV === 'development'

module.exports = {
  // Build mode
  mode: isDev ? 'development' : 'production',
  
  // Entry points
  entry: {
    main: './src/index.js',
    admin: './src/admin.js',
  },
  
  // Output configuration
  output: {
    filename: isDev ? '[name].js' : '[name].[contenthash].js',
    path: path.resolve(__dirname, 'dist'),
    clean: true,
    publicPath: '/',
  },
  
  // Module rules (loaders)
  module: {
    rules: [
      // JavaScript/TypeScript
      {
        test: /\.[jt]sx?$/,
        exclude: /node_modules/,
        use: 'babel-loader',
      },
      
      // CSS
      {
        test: /\.css$/,
        use: [
          isDev ? 'style-loader' : MiniCssExtractPlugin.loader,
          'css-loader',
          'postcss-loader',
        ],
      },
      
      // Images
      {
        test: /\.(png|jpg|gif|svg)$/,
        type: 'asset',
        parser: {
          dataUrlCondition: {
            maxSize: 8 * 1024, // 8kb
          },
        },
      },
      
      // Fonts
      {
        test: /\.(woff|woff2|eot|ttf|otf)$/,
        type: 'asset/resource',
      },
    ],
  },
  
  // Plugins
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html',
    }),
    !isDev && new MiniCssExtractPlugin({
      filename: '[name].[contenthash].css',
    }),
  ].filter(Boolean),
  
  // Resolve configuration
  resolve: {
    extensions: ['.tsx', '.ts', '.jsx', '.js'],
    alias: {
      '@': path.resolve(__dirname, 'src'),
      '@components': path.resolve(__dirname, 'src/components'),
    },
  },
  
  // Development server
  devServer: {
    port: 3000,
    hot: true,
    historyApiFallback: true,
  },
  
  // Source maps
  devtool: isDev ? 'eval-source-map' : 'source-map',
}
```

<WebpackConceptVisualizer level="intermediate" />

<ProgressCheckpoint section="core-concepts" xpReward={15} />

## Code Splitting

### Entry Point Splitting

```javascript
module.exports = {
  entry: {
    main: './src/index.js',
    vendor: './src/vendor.js',
  },
}
```

### Dynamic Imports

```javascript
// In your code - creates automatic chunks
const loadDashboard = () => import('./pages/Dashboard')
const loadSettings = () => import('./pages/Settings')

// Webpack magic comments for chunk naming
const Dashboard = () => import(
  /* webpackChunkName: "dashboard" */
  './pages/Dashboard'
)
```

### SplitChunks Configuration

```javascript
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all',
      
      cacheGroups: {
        // Vendor chunk for node_modules
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          chunks: 'all',
          priority: 20,
        },
        
        // Common chunk for shared code
        common: {
          minChunks: 2,
          priority: 10,
          reuseExistingChunk: true,
        },
      },
    },
    
    // Extract runtime into separate chunk
    runtimeChunk: 'single',
  },
}
```

<ProgressCheckpoint section="entry-output" xpReward={15} />

## Asset Modules (Webpack 5)

Webpack 5 has built-in asset handling:

```javascript
module.exports = {
  module: {
    rules: [
      // asset/resource - emit file, return URL
      {
        test: /\.(png|jpg|gif)$/,
        type: 'asset/resource',
        generator: {
          filename: 'images/[name].[hash][ext]',
        },
      },
      
      // asset/inline - inline as data URL
      {
        test: /\.svg$/,
        type: 'asset/inline',
      },
      
      // asset/source - export source code
      {
        test: /\.txt$/,
        type: 'asset/source',
      },
      
      // asset - auto choose based on size
      {
        test: /\.(png|jpg|gif|svg)$/,
        type: 'asset',
        parser: {
          dataUrlCondition: {
            maxSize: 4 * 1024, // 4kb threshold
          },
        },
      },
    ],
  },
}
```

<ProgressCheckpoint section="loaders" xpReward={15} />

## Environment Variables

### Using DefinePlugin

```javascript
const webpack = require('webpack')

module.exports = {
  plugins: [
    new webpack.DefinePlugin({
      'process.env.API_URL': JSON.stringify(process.env.API_URL),
      '__DEV__': JSON.stringify(process.env.NODE_ENV === 'development'),
    }),
  ],
}
```

### Using dotenv-webpack

```javascript
const Dotenv = require('dotenv-webpack')

module.exports = {
  plugins: [
    new Dotenv({
      path: './.env',
      safe: true, // Load .env.example for validation
    }),
  ],
}
```

<ProgressCheckpoint section="plugins" xpReward={15} />

## Development vs Production

```javascript
// webpack.common.js - Shared configuration
module.exports = {
  entry: './src/index.js',
  module: {
    rules: [/* ... */],
  },
}

// webpack.dev.js
const { merge } = require('webpack-merge')
const common = require('./webpack.common.js')

module.exports = merge(common, {
  mode: 'development',
  devtool: 'eval-source-map',
  devServer: {
    hot: true,
    port: 3000,
  },
})

// webpack.prod.js
const { merge } = require('webpack-merge')
const common = require('./webpack.common.js')
const TerserPlugin = require('terser-webpack-plugin')

module.exports = merge(common, {
  mode: 'production',
  devtool: 'source-map',
  optimization: {
    minimizer: [new TerserPlugin()],
  },
})
```

```json
{
  "scripts": {
    "start": "webpack serve --config webpack.dev.js",
    "build": "webpack --config webpack.prod.js"
  }
}
```

<DependencyGraphExplorer 
  initialModules={[
    { id: 'entry', name: 'index.js', imports: ['app', 'vendor'], exports: [], size: 50 },
    { id: 'app', name: 'App.jsx', imports: ['react', 'components', 'styles'], exports: ['App'], size: 150 },
    { id: 'vendor', name: 'vendor.js', imports: ['react', 'lodash'], exports: [], size: 30 },
    { id: 'react', name: 'react (chunk)', imports: [], exports: ['useState'], size: 100 },
    { id: 'lodash', name: 'lodash (chunk)', imports: [], exports: ['debounce'], size: 80 },
    { id: 'components', name: 'components/', imports: ['react'], exports: ['Button'], size: 120 },
    { id: 'styles', name: 'styles.css', imports: [], exports: [], size: 40 },
  ]}
  editable={true}
/>

<ProgressCheckpoint section="dev-server" xpReward={15} />

## Quick Quiz

<Quiz>
  <Question text="What does [contenthash] do in output filenames?">
    <Answer>Adds the current date</Answer>
    <Answer correct>Creates a hash based on file content for cache busting</Answer>
    <Answer>Adds a random string</Answer>
    <Answer>Includes the file size</Answer>
  </Question>
  
  <Question text="How do you create named chunks with dynamic imports?">
    <Answer>Use the chunkName option</Answer>
    <Answer correct>Use webpackChunkName magic comment</Answer>
    <Answer>Configure splitChunks</Answer>
    <Answer>Name the import variable</Answer>
  </Question>
  
  <Question text="What's the purpose of runtimeChunk: 'single'?">
    <Answer>To make builds faster</Answer>
    <Answer correct>To extract Webpack runtime for better caching</Answer>
    <Answer>To reduce bundle size</Answer>
    <Answer>To enable hot reloading</Answer>
  </Question>
</Quiz>

<ProgressCheckpoint section="hands-on" xpReward={15} />

<ProgressCheckpoint section="summary" xpReward={15} />

---

**Excellent!**  You now understand Webpack configuration in depth. In the advanced level, we'll explore custom plugins, performance optimization, and advanced patterns!
