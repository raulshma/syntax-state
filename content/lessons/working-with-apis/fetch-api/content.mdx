# Fetch API: Modern HTTP Requests

The Fetch API is the modern, Promise-based way to make HTTP requests in JavaScript. It's cleaner, more powerful, and built into all modern browsers. Say goodbye to callback hell!

---

## Section 1: Fetch Basics

### The Simple Power of Fetch

Fetch makes HTTP requests beautifully simple:

```javascript
// That's it! A complete GET request
fetch('https://api.example.com/data')
  .then(response => response.json())
  .then(data => console.log(data));
```

<ApiRequestBuilder />

<CodePlayground
  initialCode={`// Basic fetch examples

// Simple GET request
fetch('https://jsonplaceholder.typicode.com/posts/1')
  .then(response => {
    console.log('Status:', response.status);
    console.log('OK?', response.ok);
    return response.json(); // Parse JSON body
  })
  .then(data => {
    console.log('Data:', data);
  })
  .catch(error => {
    console.error('Error:', error);
  });

// With async/await (cleaner!)
async function getPost() {
  const response = await fetch('https://jsonplaceholder.typicode.com/posts/2');
  const data = await response.json();
  console.log('Async post:', data.title);
}

getPost();`}
  height={320}
/>

<KeyConcept title="Two-Step Response Handling">
Fetch returns a Response object, not the data directly. You must call a method like `.json()`, `.text()`, or `.blob()` to get the actual content. This is also a Promise!
</KeyConcept>

### Response Methods

| Method | Returns | Use For |
|:-------|:--------|:--------|
| `response.json()` | Parsed JSON | API responses |
| `response.text()` | String | HTML, plain text |
| `response.blob()` | Blob | Images, files |
| `response.arrayBuffer()` | ArrayBuffer | Binary data |
| `response.formData()` | FormData | Form submissions |

<ProgressCheckpoint section="fetch-basics" xpReward={25} />

---

## Section 2: Request Options

### Customizing Your Requests

The second argument to `fetch()` lets you configure everything:

```javascript
fetch(url, {
  method: 'POST',           // HTTP method
  headers: {                // Request headers
    'Content-Type': 'application/json',
    'Authorization': 'Bearer token123'
  },
  body: JSON.stringify(data), // Request body
  mode: 'cors',             // CORS mode
  credentials: 'include',   // Send cookies
  cache: 'no-cache'         // Cache behavior
});
```


<CodePlayground
  initialCode={`// Different HTTP methods with fetch

const API_URL = 'https://jsonplaceholder.typicode.com';

// GET - Retrieve data
async function getUsers() {
  const response = await fetch(API_URL + '/users');
  return response.json();
}

// POST - Create new resource
async function createPost(post) {
  const response = await fetch(API_URL + '/posts', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(post)
  });
  return response.json();
}

// PUT - Update entire resource
async function updatePost(id, post) {
  const response = await fetch(API_URL + '/posts/' + id, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(post)
  });
  return response.json();
}

// DELETE - Remove resource
async function deletePost(id) {
  const response = await fetch(API_URL + '/posts/' + id, {
    method: 'DELETE'
  });
  return response.ok;
}

// Demo
async function demo() {
  // Create
  const newPost = await createPost({
    title: 'My Post',
    body: 'Content here',
    userId: 1
  });
  console.log('Created:', newPost);
  
  // Update
  const updated = await updatePost(1, {
    title: 'Updated Title',
    body: 'New content',
    userId: 1
  });
  console.log('Updated:', updated);
  
  // Delete
  const deleted = await deletePost(1);
  console.log('Deleted:', deleted);
}

demo();`}
  height={480}
/>

<ProgressCheckpoint section="request-options" xpReward={25} />

---

## Section 3: Response Handling

### Understanding the Response Object

The Response object contains everything about the server's response:

```javascript
const response = await fetch(url);

// Status information
response.status;     // 200, 404, 500, etc.
response.statusText; // "OK", "Not Found", etc.
response.ok;         // true if status is 200-299

// Headers
response.headers.get('Content-Type');
response.headers.get('X-Custom-Header');

// Body (can only be read once!)
const data = await response.json();
```

<ResponseInspector />

<CodePlayground
  initialCode={`// Exploring the Response object

async function exploreResponse() {
  const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
  
  // Status info
  console.log('=== Status ===');
  console.log('status:', response.status);
  console.log('statusText:', response.statusText);
  console.log('ok:', response.ok);
  console.log('type:', response.type);
  console.log('url:', response.url);
  
  // Headers
  console.log('\\n=== Headers ===');
  console.log('Content-Type:', response.headers.get('content-type'));
  
  // Iterate all headers
  response.headers.forEach((value, key) => {
    console.log(key + ':', value);
  });
  
  // Body - can only read once!
  console.log('\\n=== Body ===');
  const data = await response.json();
  console.log('Data:', data);
  
  // This would fail - body already consumed!
  // const text = await response.text(); // Error!
}

exploreResponse();`}
  height={400}
/>

<InfoBox type="warning">
**Body Can Only Be Read Once!** The response body is a stream that can only be consumed once. If you need to read it multiple times, clone the response first: `response.clone()`
</InfoBox>

<ProgressCheckpoint section="response-handling" xpReward={20} />

---

## Section 4: Advanced Fetch Patterns

### Aborting Requests

Use `AbortController` to cancel fetch requests:

```javascript
const controller = new AbortController();

// Pass signal to fetch
fetch(url, { signal: controller.signal })
  .then(response => response.json())
  .catch(err => {
    if (err.name === 'AbortError') {
      console.log('Request was cancelled');
    }
  });

// Cancel the request
controller.abort();
```

<CodePlayground
  initialCode={`// Advanced fetch patterns

// 1. Timeout with AbortController
async function fetchWithTimeout(url, timeout = 5000) {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeout);
  
  try {
    const response = await fetch(url, { signal: controller.signal });
    clearTimeout(timeoutId);
    return response;
  } catch (error) {
    clearTimeout(timeoutId);
    if (error.name === 'AbortError') {
      throw new Error('Request timed out');
    }
    throw error;
  }
}

// 2. Parallel requests
async function fetchMultiple() {
  const urls = [
    'https://jsonplaceholder.typicode.com/posts/1',
    'https://jsonplaceholder.typicode.com/posts/2',
    'https://jsonplaceholder.typicode.com/posts/3'
  ];
  
  // Fetch all in parallel
  const responses = await Promise.all(urls.map(url => fetch(url)));
  const data = await Promise.all(responses.map(r => r.json()));
  
  console.log('Fetched', data.length, 'posts in parallel');
  data.forEach(post => console.log('-', post.title));
}

// 3. Retry logic
async function fetchWithRetry(url, retries = 3) {
  for (let i = 0; i < retries; i++) {
    try {
      const response = await fetch(url);
      if (response.ok) return response;
      throw new Error('HTTP ' + response.status);
    } catch (error) {
      console.log('Attempt ' + (i + 1) + ' failed:', error.message);
      if (i === retries - 1) throw error;
      await new Promise(r => setTimeout(r, 1000 * (i + 1))); // Exponential backoff
    }
  }
}

// Demo
fetchMultiple();`}
  height={480}
/>

<Quiz id="fetch-quiz">
  <Question>What does `response.ok` return?</Question>
  <Answer>The response body</Answer>
  <Answer>The status code</Answer>
  <Answer correct>true if status is 200-299, false otherwise</Answer>
  <Answer>The response headers</Answer>
</Quiz>

### Fetch vs XHR Summary

| Feature | Fetch | XHR |
|:--------|:------|:----|
| Syntax | Promise-based | Callback-based |
| Simplicity |  Very clean |  Verbose |
| Streaming |  Built-in |  Limited |
| Abort | `AbortController` | `xhr.abort()` |
| Progress |  Complex |  Built-in events |
| Cookies | Manual (`credentials`) | Automatic |

<ProgressCheckpoint section="advanced-fetch" xpReward={20} />
